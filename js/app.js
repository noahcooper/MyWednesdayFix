/* MyWednesdayFix - app.js | Version: 0.2 (07-NOV-2013) */
(function(e){"use strict";var t={};t.data={currentIssue:{}};t.comicVine={getIssuesByStoreDate:function(t){var n=e.extend({limit:"24",callback:e.noop},t||{});e.ajax({dataType:"jsonp",url:"http://www.comicvine.com/api/issues"+"?api_key=e21e187f67061d346687aeb81969a3fd2d1676fa"+"&field_list=api_detail_url,store_date,description,image,issue_number,volume"+"&limit="+n.limit+"&sort=store_date:desc"+"&format=jsonp"+"&json_callback=?",success:n.callback})},getIssue:function(t){var n=e.extend({callback:e.noop},t||{});e.ajax({dataType:"jsonp",url:"http://www.comicvine.com/api/issue/"+n.issueId+"?api_key=e21e187f67061d346687aeb81969a3fd2d1676fa"+"&field_list=store_date,description,image,issue_number,person_credits,volume"+"&format=jsonp"+"&json_callback=?",success:n.callback})}};t.utils={loadView:function(e){t.view[e]()},showLoading:function(){e("#content-loading").show()},hideLoading:function(){e("#content-loading").hide()},setHeadline:function(t){e("#content-headline").html(t)},resetContent:function(){e("#content-wrap").html("")}};t.ui={buildIssuesList:function(t){var n=e.extend({issuesList:[],dateFilter:"current"},t||{});e.each(n.issuesList,function(){var t=new Date,r=this.store_date.split("-"),i=r[0],s=r[1],o=r[2],u=new Date(i,s-1,o,t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),a=(u-t)/864e5,f=-1<t.getDay()+a&&t.getDay()+a<7;if(n.dateFilter==="current"&&f||n.dateFilter==="future"&&a>0&&!f){if(e("#content-wrap .row").length===0||e("#content-wrap .row:last .feature-col").length===3){e("#content-wrap").append('<div class="row" />')}var l=this.api_detail_url.split("/issue/")[1].split("/")[0],c=this.volume.name,h=this.issue_number;e("#content-wrap .row:last").append('<div class="col-sm-4 feature-col">'+'<div class="panel panel-info">'+'<div class="panel-heading">'+'<h3 class="panel-title">'+'<a class="view-issue" href="#issue='+l+'" data-issue="'+l+'">'+c+(h?" #"+h:"")+"</a>"+"</h3>"+"</div>"+'<div class="panel-body">'+(this.image.small_url?'<div class="feature-image-wrap">'+'<a href="#"><img alt="" src="'+this.image.small_url+'"></a>'+"</div>":"")+"<h3>In Stores "+s+"/"+o+"/"+i+"</h3>"+(this.description||"")+"<p>"+'<a class="btn btn-primary view-issue" href="#issue='+l+'" data-issue="'+l+'">'+"Read more Â»"+"</a>"+"</p>"+"</div>"+"</div>"+"</div>")}})},buildIssue:function(t){var n=e.extend({issue:{}},t||{}),r=n.issue,i=r.volume.name,s=r.issue_number,o=r.store_date.split("-"),u=o[0],a=o[1],f=o[2];e("#content-wrap").append('<div class="row">'+'<div class="col-xs-12 feature-col">'+'<div class="panel panel-info">'+'<div class="panel-heading">'+'<h3 class="panel-title">'+i+(s?" #"+s:"")+"</h3>"+"</div>"+'<div class="panel-body">'+(r.image.medium_url?'<div class="col-md-6 feature-image-wrap">'+'<a href="#"><img alt="" src="'+r.image.medium_url+'"></a>'+"</div>":"")+"<h3>In Stores "+a+"/"+f+"/"+u+"</h3>"+(r.description||"")+"</div>"+"</div>"+"</div>"+"</div>");e.each(r.person_credits,function(t){e("#content-wrap .panel-body").append((t>0?"<br>":"")+'<span class="issue-credits">'+this.name+(this.role?", "+this.role:"")+"</span>")})}};t.view={findStore:function(){t.utils.setHeadline("Find a Store");t.utils.resetContent()},thisWeek:function(){t.utils.setHeadline("New This Week");t.utils.resetContent();t.utils.showLoading();t.comicVine.getIssuesByStoreDate({limit:"100",callback:function(e){t.utils.hideLoading();t.ui.buildIssuesList({issuesList:e.results})}})},comingSoon:function(){t.utils.setHeadline("Coming Soon");t.utils.resetContent();t.utils.showLoading();t.comicVine.getIssuesByStoreDate({callback:function(e){t.utils.hideLoading();t.ui.buildIssuesList({issuesList:e.results,dateFilter:"future"})}})},viewIssue:function(){t.utils.setHeadline("");t.utils.resetContent();t.utils.showLoading();t.comicVine.getIssue({issueId:t.data.currentIssue.issueId,callback:function(e){t.utils.hideLoading();t.ui.buildIssue({issue:e.results})}})}};e(".app-nav").click(function(){t.utils.loadView(e(this).data("view"))});e("#content-wrap").on("click",".view-issue",function(n){t.data.currentIssue.issueId=e(n.target).data("issue");t.utils.loadView("viewIssue")});e(function(){t.view.thisWeek()})})(jQuery)